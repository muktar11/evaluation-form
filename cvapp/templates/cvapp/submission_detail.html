{% extends 'cvapp/base.html' %}
{% block content %}

<div class="card shadow-sm p-4 mb-4 text-end" dir="rtl">
  <h2 class="mb-3">{{ submission.name }}</h2>

  <ul class="list-group list-group-flush mb-3">
    <li class="list-group-item"><strong>Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø´ÙŠØ­:</strong> {{ submission.passport_number }}</li>
    <li class="list-group-item"><strong>Ø§Ù„Ø¬Ù†Ø³ÙŠØ©:</strong> {{ submission.nationality }}</li>
    <li class="list-group-item"><strong>Ø§Ù„Ø¹Ù…Ø±:</strong> {{ submission.age }}</li>
    <li class="list-group-item"><strong>Ø§Ù„Ù„ØºØ©:</strong> {{ submission.language }}</li>
    <li class="list-group-item"><strong>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©:</strong> {{ submission.health }}</li>
    <li class="list-group-item"><strong>Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª:</strong> {{ submission.mental_state }}</li>
    <li class="list-group-item">
      <strong>Ø§Ù„ÙˆØµÙ Ø§Ù„Ø´Ø®ØµÙŠ:</strong>
      <p class="mt-1">{{ submission.self_description|linebreaks }}</p>
    </li>
    {% if submission.video %}
    <li class="list-group-item">
      <strong>Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:</strong> 
      <a href="{{ submission.video.url }}" target="_blank" class="btn btn-outline-primary btn-sm">Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø±ÙÙˆØ¹</a>
    </li>
    {% endif %}
  </ul>

  <div class="mt-3 d-flex gap-2 justify-content-end">
    <!-- Ø²Ø± Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· -->
    <button id="copyBtn" class="btn btn-success btn-custom">ğŸ“‹ Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</button>

    <!-- Ø²Ø± Ø§Ù„Ø­Ø¬Ø² -->
    <a href="{% url 'cvapp:book_submission' submission.id %}" class="btn btn-primary btn-custom">ğŸ“– Ø­Ø¬Ø²</a>
  </div>
</div>

<!-- âœ… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø³Ø® -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  <div id="copyToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
    </div>
  </div>
</div>

<!-- âœ… ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const copyBtn = document.getElementById('copyBtn');
  const toastEl = document.getElementById('copyToast');
  const toast = new bootstrap.Toast(toastEl);

  copyBtn.addEventListener('click', function() {
    const url = '{{ request.scheme }}://{{ request.get_host }}{% url "cvapp:preview_submission" submission.id %}';
    
    try {
      // Ø­Ù„ Ø¨Ø¯ÙŠÙ„ Ù„Ù„Ù†Ø³Ø® ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ø¯Ø¹Ù… HTTPS
      const textArea = document.createElement('textarea');
      textArea.value = url;
      document.body.appendChild(textArea);
      textArea.select();
      const successful = document.execCommand('copy');
      document.body.removeChild(textArea);

      if (successful) {
        toast.show();
      } else {
        alert('âŒ ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠÙ‹Ø§:\n' + url);
      }
    } catch (err) {
      alert('âŒ ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠÙ‹Ø§:\n' + url);
    }
  });
});
</script>

{% endblock %}
